//
// Copyright (c) Microsoft. All rights reserved.
// Licensed under the MIT license. See LICENSE file in the project root for full license information.
//

#nullable disable

using System.Collections.Generic;
using Microsoft.SqlTools.Hosting.Protocol.Contracts;

namespace Microsoft.SqlTools.ServiceLayer.LanguageServices.Contracts
{
    /// <summary>
    /// Parameters to be sent back with a non-TSQL file event.
    /// </summary>
    public class NonTSqlParams
    {
        /// <summary>
        /// URI identifying the file detected as non-TSQL.
        /// </summary>
        public string OwnerUri { get; set; }

        /// <summary>
        /// If null, indicates that the script was flagged due to the error limit
        /// Else, contains the word the script was flagged for 
        /// </summary>
        public string NonTSqlKeyword { get; set; }
    }

    /// <summary>
    /// NonTSqlNotification notification mapping entry.
    /// </summary>
    public class NonTSqlNotification
    {
        public static readonly EventType<NonTSqlParams> Type =
            EventType<NonTSqlParams>.Create("textDocument/nonTSqlFileDetected");
    }

    public static class TSqlDetectionConstants
    {
        /// <summary>
        /// The error threshold for when a file is considered non-TSQL.
        /// </summary>
        /// 
        public const int SqlFileErrorLimit = 50;

        /// <summary>
        /// A list of keywords that exist in MySQL and PostgreSQL documentation
        /// but are not present in T-SQL documentation.
        /// Sources:
        /// - MySQL: https://dev.mysql.com/doc/refman/8.4/en/keywords.html
        /// - PostgreSQL: https://www.postgresql.org/docs/current/sql-keywords-appendix.html
        /// - T-SQL: https://learn.microsoft.com/en-us/sql/t-sql/language-elements/reserved-keywords-transact-sql
        /// Some of the MySql keywords have an overlap with PGSQL keywords 
        /// </summary>
        public static readonly HashSet<string> Keywords = new HashSet<string>(new[]
        {
            // MYSQL words
            "ACCESSIBLE",
            "AGAINST",
            "ANALYZE",
            "AUTOEXTEND_SIZE",
            "AUTO_INCREMENT",
            "AVG_ROW_LENGTH",
            "BERNOULLI",
            "BINLOG",
            "BOOL",
            "BTREE",
            "BUCKETS",
            "BYTE",
            "CHAIN",
            "CHALLENGE_RESPONSE",
            "CHANNEL",
            "CHARSET",
            "CIPHER",
            "CLASS_ORIGIN",
            "CLONE",
            "COLUMN_FORMAT",
            "COMMITTED",
            "COMPACT",
            "COMPONENT",
            "COMPRESSED",
            "COMPRESSION",
            "CONCURRENT",
            "CONSISTENT",
            "CONSTRAINT_CATALOG",
            "CONSTRAINT_SCHEMA",
            "CONTEXT",
            "CPU",
            "DATAFILE",
            "DAY_HOUR",
            "DAY_MICROSECOND",
            "DAY_MINUTE",
            "DAY_SECOND",
            "DEFAULT_AUTH",
            "DEFINER",
            "DELAYED",
            "DELAY_KEY_WRITE",
            "DIRECTORY",
            "DISCARD",
            "DISTINCTROW",
            "DIV",
            "DO",
            "DUAL",
            "DUMPFILE",
            "DUPLICATE",
            "ELSEIF",
            "EMPTY",
            "ENCLOSED",
            "ENFORCED",
            "ENGINE",
            "ENGINES",
            "ENGINE_ATTRIBUTE",
            "ESCAPED",
            "EXCHANGE",
            "EXPANSION",
            "EXPIRE",
            "EXPLAIN",
            "EXTENDED",
            "EXTENT_SIZE",
            "FACTOR",
            "FAILED_LOGIN_ATTEMPTS",
            "FAULTS",
            "FILE_BLOCK_SIZE",
            "FINISH",
            "FIRST_VALUE",
            "FIXED",
            "FLOAT4",
            "FLOAT8",
            "FLUSH",
            "FOLLOWING",
            "FOLLOWS",
            "GENERATE",
            "GEOMCOLLECTION",
            "GEOMETRYCOLLECTION",
            "GET_FORMAT",
            "GET_SOURCE_PUBLIC_KEY",
            "GRANTS",
            "GROUP_REPLICATION",
            "GTIDS",
            "GTID_ONLY",
            "HANDLER",
            "HIGH_PRIORITY",
            "HISTOGRAM",
            "HOUR_MICROSECOND",
            "HOUR_MINUTE",
            "HOUR_SECOND",
            "IDENTIFIED",
            "IGNORE_SERVER_IDS",
            "INACTIVE",
            "INFILE",
            "INITIAL",
            "INITIAL_SIZE",
            "INITIATE",
            "INSERT_METHOD",
            "INSTALL",
            "INT1",
            "INT2",
            "INT3",
            "INT4",
            "INT8",
            "INVISIBLE",
            "INVOKER",
            "IO",
            "IO_AFTER_GTIDS",
            "IO_BEFORE_GTIDS",
            "IO_THREAD",
            "IPC",
            "JSON_TABLE",
            "KEYRING",
            "KEY_BLOCK_SIZE",
            "LAST_VALUE",
            "LEAVE",
            "LEAVES",
            "LINEAR",
            "LINESTRING",
            "LOCK",
            "LOCKS",
            "LOGFILE",
            "LONG",
            "LONGBLOB",
            "LONGTEXT",
            "LOW_PRIORITY",
            "MANUAL",
            "MAX_CONNECTIONS_PER_HOUR",
            "MAX_QUERIES_PER_HOUR",
            "MAX_ROWS",
            "MAX_SIZE",
            "MAX_UPDATES_PER_HOUR",
            "MAX_USER_CONNECTIONS",
            "MEDIUM",
            "MEDIUMBLOB",
            "MEDIUMINT",
            "MEDIUMTEXT",
            "MESSAGE_TEXT",
            "MICROSECOND",
            "MIDDLEINT",
            "MIGRATE",
            "MINUTE_MICROSECOND",
            "MINUTE_SECOND",
            "MIN_ROWS",
            "MULTILINESTRING",
            "MULTIPOINT",
            "MULTIPOLYGON",
            "MUTEX",
            "MYSQL_ERRNO",
            "NDB",
            "NDBCLUSTER",
            "NESTED",
            "NETWORK_NAMESPACE",
            "NEVER",
            "NODEGROUP",
            "NOWAIT",
            "NO_WAIT",
            "NO_WRITE_TO_BINLOG",
            "NTH_VALUE",
            "NTILE",
            "NULLS",
            "OJ",
            "OPTIMIZER_COSTS",
            "OPTIONALLY",
            "OTHERS",
            "PACK_KEYS",
            "PARALLEL",
            "PARSER",
            "PARSE_TREE",
            "PARTITIONING",
            "PARTITIONS",
            "PASSWORD_LOCK_TIME",
            "PERSIST",
            "PERSIST_ONLY",
            "PLUGIN",
            "PLUGINS",
            "PLUGIN_DIR",
            "POLYGON",
            "PRECEDES",
            "PREV",
            "PRIVILEGE_CHECKS_USER",
            "PROCESSLIST",
            "PROXY",
            "PURGE",
            "QUALIFY",
            "QUARTER",
            "QUICK",
            "RANDOM",
            "RECOVER",
            "REDO_BUFFER_SIZE",
            "REDUNDANT",
            "REFERENCE",
            "REGEXP",
            "REGISTRATION",
            "RELAY",
            "RELAYLOG",
            "RELAY_LOG_FILE",
            "RELAY_LOG_POS",
            "RELAY_THREAD",
            "RELOAD",
            "REMOVE",
            "REPAIR",
            "REPEAT",
            "REPEATABLE",
            "REPLICA",
            "REPLICAS",
            "REPLICATE_DO_DB",
            "REPLICATE_DO_TABLE",
            "REPLICATE_IGNORE_DB",
            "REPLICATE_IGNORE_TABLE",
            "REPLICATE_REWRITE_DB",
            "REPLICATE_WILD_DO_TABLE",
            "REPLICATE_WILD_IGNORE_TABLE",
            "REQUIRE",
            "REQUIRE_ROW_FORMAT",
            "RESET",
            "RESIGNAL",
            "RESPECT",
            "RESTART",
            "RESUME",
            "RETAIN",
            "RETURNED_SQLSTATE",
            "RETURNING",
            "REUSE",
            "RLIKE",
            "ROTATE",
            "ROW_COUNT",
            "ROW_FORMAT",
            "RTREE",
            "S3",
            "SECONDARY",
            "SECONDARY_ENGINE",
            "SECONDARY_ENGINE_ATTRIBUTE",
            "SECONDARY_LOAD",
            "SECONDARY_UNLOAD",
            "SECOND_MICROSECOND",
            "SEPARATOR",
            "SERIAL",
            "SERIALIZABLE",
            "SHARE",
            "SIGNAL",
            "SIGNED",
            "SLAVE",
            "SLOW",
            "SONAME",
            "SOUNDS",
            "SOURCE_AUTO_POSITION",
            "SOURCE_BIND",
            "SOURCE_COMPRESSION_ALGORITHMS",
            "SOURCE_CONNECT_RETRY",
            "SOURCE_DELAY",
            "SOURCE_HEARTBEAT_PERIOD",
            "SOURCE_HOST",
            "SOURCE_LOG_FILE",
            "SOURCE_LOG_POS",
            "SOURCE_PASSWORD",
            "SOURCE_PORT",
            "SOURCE_PUBLIC_KEY_PATH",
            "SOURCE_RETRY_COUNT",
            "SOURCE_SSL",
            "SOURCE_SSL_CA",
            "SOURCE_SSL_CAPATH",
            "SOURCE_SSL_CERT",
            "SOURCE_SSL_CIPHER",
            "SOURCE_SSL_CRL",
            "SOURCE_SSL_CRLPATH",
            "SOURCE_SSL_KEY",
            "SOURCE_SSL_VERIFY_SERVER_CERT",
            "SOURCE_TLS_CIPHERSUITES",
            "SOURCE_TLS_VERSION",
            "SOURCE_USER",
            "SOURCE_ZSTD_COMPRESSION_LEVEL",
            "SPATIAL",
            "SQL_AFTER_GTIDS",
            "SQL_AFTER_MTS_GAPS",
            "SQL_BEFORE_GTIDS",
            "SQL_BIG_RESULT",
            "SQL_BUFFER_RESULT",
            "SQL_CALC_FOUND_ROWS",
            "SQL_NO_CACHE",
            "SQL_SMALL_RESULT",
            "SQL_THREAD",
            "SQL_TSI_DAY",
            "SQL_TSI_HOUR",
            "SQL_TSI_MINUTE",
            "SQL_TSI_MONTH",
            "SQL_TSI_QUARTER",
            "SQL_TSI_SECOND",
            "SQL_TSI_WEEK",
            "SQL_TSI_YEAR",
            "SRID",
            "SSL",
            "STACKED",
            "STARTING",
            "STARTS",
            "STATS_AUTO_RECALC",
            "STATS_PERSISTENT",
            "STATS_SAMPLE_PAGES",
            "STRAIGHT_JOIN",
            "STREAM",
            "SUBCLASS_ORIGIN",
            "SUBPARTITION",
            "SUBPARTITIONS",
            "SUPER",
            "SUSPEND",
            "SWAPS",
            "SWITCHES",
            "TABLESPACE",
            "TABLE_CHECKSUM",
            "TEMPTABLE",
            "TERMINATED",
            "THREAD_PRIORITY",
            "TIES",
            "TIMESTAMPADD",
            "TIMESTAMPDIFF",
            "TINYBLOB",
            "TINYTEXT",
            "TLS",
            "UNCOMMITTED",
            "UNDO",
            "UNDOFILE",
            "UNDO_BUFFER_SIZE",
            "UNINSTALL",
            "UNLOCK",
            "UNREGISTER",
            "UNSIGNED",
            "UNTIL",
            "UPGRADE",
            "USER_RESOURCES",
            "USE_FRM",
            "UTC_TIME",
            "UTC_TIMESTAMP",
            "VARCHARACTER",
            "VCPU",
            "VIRTUAL",
            "WEIGHT_STRING",
            "WRAPPER",
            "X509",
            "XA",
            "XID",
            "XOR",
            "YEAR_MONTH",
            "ZEROFILL",
            // PGSQL words
            "ABSENT",
            "ACCORDING",
            "ALSO",
            "ANALYSE",
            "ANY_VALUE",
            "ARRAY_AGG",
            "ARRAY_​MAX_​CARDINALITY",
            "ASSIGNMENT",
            "BACKWARD",
            "BASE64",
            "BEGIN_FRAME",
            "BEGIN_PARTITION",
            "BLOCKED",
            "BOM",
            "BTRIM",
            "CEIL",
            "CHAINING",
            "CHARACTER_SET_SCHEMA",
            "CHARACTER_​SET_​CATALOG",
            "COBOL",
            "COLLATION_CATALOG",
            "COLLATION_SCHEMA",
            "COMMAND_FUNCTION",
            "COMMAND_​FUNCTION_​CODE",
            "CONCURRENTLY",
            "CONDITIONAL",
            "CONDITION_NUMBER",
            "CONFLICT",
            "CONVERSION",
            "COPARTITION",
            "COPY",
            "COSH",
            "CURRENT_ROW",
            "CURRENT_​DEFAULT_​TRANSFORM_​GROUP",
            "CURRENT_​TRANSFORM_​GROUP_​FOR_​TYPE",
            "DATALINK",
            "DATETIME_​INTERVAL_​CODE",
            "DATETIME_​INTERVAL_​PRECISION",
            "DB",
            "DECFLOAT",
            "DEFAULTS",
            "DEFINE",
            "DEFINED",
            "DELIMITER",
            "DEPENDS",
            "DERIVED",
            "DETACH",
            "DISPATCH",
            "DLNEWCOPY",
            "DLPREVIOUSCOPY",
            "DLURLCOMPLETE",
            "DLURLCOMPLETEONLY",
            "DLURLCOMPLETEWRITE",
            "DLURLPATH",
            "DLURLPATHONLY",
            "DLURLPATHWRITE",
            "DLURLSCHEME",
            "DLURLSERVER",
            "DLVALUE",
            "DYNAMIC_FUNCTION",
            "DYNAMIC_​FUNCTION_​CODE",
            "ENCODING",
            "END_FRAME",
            "END_PARTITION",
            "EXCLUSIVE",
            "EXPRESSION",
            "EXTENSION",
            "FINAL",
            "FINALIZE",
            "FLAG",
            "FORWARD",
            "FRAME_ROW",
            "FREEZE",
            "FS",
            "FULFILL",
            "GRANTED",
            "HEADER",
            "ILIKE",
            "IMMEDIATELY",
            "IMMUTABLE",
            "IMPLEMENTATION",
            "IMPLICIT",
            "INDENT",
            "INHERIT",
            "INHERITS",
            "INLINE",
            "INSTANTIABLE",
            "INTEGRITY",
            "JSON_ARRAY",
            "JSON_ARRAYAGG",
            "JSON_EXISTS",
            "JSON_OBJECT",
            "JSON_OBJECTAGG",
            "JSON_SCALAR",
            "JSON_SERIALIZE",
            "JSON_TABLE_PRIMITIVE",
            "KEY_MEMBER",
            "LEAKPROOF",
            "LIBRARY",
            "LISTAGG",
            "LISTEN",
            "LOGGED",
            "LPAD",
            "MAPPING",
            "MATCHES",
            "MATCH_NUMBER",
            "MATCH_RECOGNIZE",
            "MATERIALIZED",
            "MERGE_ACTION",
            "MESSAGE_LENGTH",
            "MESSAGE_OCTET_LENGTH",
            "MUMPS",
            "NAMESPACE",
            "NESTING",
            "NFC",
            "NFD",
            "NFKC",
            "NFKD",
            "NIL",
            "NORMALIZED",
            "NOTHING",
            "NOTIFY",
            "NOTNULL",
            "NULLABLE",
            "NULL_ORDERING",
            "OCCURRENCE",
            "OCTETS",
            "OIDS",
            "OMIT",
            "OPERATOR",
            "ORDERING",
            "OVERFLOW",
            "OVERRIDING",
            "OWNED",
            "PARAMETER_MODE",
            "PARAMETER_​ORDINAL_​POSITION",
            "PARAMETER_​SPECIFIC_​CATALOG",
            "PARAMETER_​SPECIFIC_​NAME",
            "PARAMETER_​SPECIFIC_​SCHEMA",
            "PASSING",
            "PASSTHROUGH",
            "PAST",
            "PERMUTE",
            "PIPE",
            "PLACING",
            "PLANS",
            "PLI",
            "PORTION",
            "PREPARED",
            "PRIVATE",
            "PROCEDURAL",
            "PROGRAM",
            "PRUNE",
            "PTF",
            "REASSIGN",
            "RECHECK",
            "REFRESH",
            "REINDEX",
            "REQUIRING",
            "RETURNED_CARDINALITY",
            "RETURNED_LENGTH",
            "RETURNED_​OCTET_​LENGTH",
            "ROUTINE_CATALOG",
            "ROUTINE_SCHEMA",
            "RPAD",
            "RUNNING",
            "SCALAR",
            "SCALE",
            "SCOPE_CATALOG",
            "SCOPE_SCHEMA",
            "SEEK",
            "SELECTIVE",
            "SEMANTICS",
            "SEQUENCES",
            "SETOF",
            "SINH",
            "SORT_DIRECTION",
            "STABLE",
            "STANDALONE",
            "STDIN",
            "STDOUT",
            "STRICT",
            "STRIP",
            "STYLE",
            "SUBSCRIPTION",
            "SUBSET",
            "SUCCEEDS",
            "SUPPORT",
            "SYSID",
            "TANH",
            "TEMP",
            "TEMPLATE",
            "THROUGH",
            "TOP_LEVEL_COUNT",
            "TRANSACTIONS_​COMMITTED",
            "TRANSACTIONS_​ROLLED_​BACK",
            "TRANSACTION_ACTIVE",
            "TRANSFORM",
            "TRIGGER_CATALOG",
            "TRIGGER_SCHEMA",
            "TRIM_ARRAY",
            "TRUSTED",
            "UNCONDITIONAL",
            "UNENCRYPTED",
            "UNLINK",
            "UNLISTEN",
            "UNLOGGED",
            "UNMATCHED",
            "UNNAMED",
            "UNTYPED",
            "USER_​DEFINED_​TYPE_​CATALOG",
            "USER_​DEFINED_​TYPE_​CODE",
            "USER_​DEFINED_​TYPE_​NAME",
            "USER_​DEFINED_​TYPE_​SCHEMA",
            "UTF16",
            "UTF32",
            "UTF8",
            "VACUUM",
            "VALIDATE",
            "VALIDATOR",
            "VALUE_OF",
            "VARIADIC",
            "VERSIONING",
            "VOLATILE",
            "WHITESPACE",
            "XMLDECLARATION",
            "XMLROOT",
            "XMLSCHEMA",
        },
        System.StringComparer.OrdinalIgnoreCase);
    }
}
