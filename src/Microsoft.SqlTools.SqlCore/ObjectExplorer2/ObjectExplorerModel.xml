<ObjectExplorerModel>
  <Node Name="Database" Type="Database" Icon="Database" isLeaf="false">
    <ChildQuerier Type="Schema" />
  </Node>

  <!-- Schema Query -->
  <Querier Name="Schema" Node="Schema" Query="
SELECT
    S.name AS schemaName,
    S.name AS objectName,
    DB_NAME() AS parentName,
    S.name AS displayName,
    'Schema' AS type
From
    sys.schemas AS S
" />

  <!-- Schema Node -->
  <Node Name="Schema" Type="Schema" Icon="Schema" isLeaf="false">
    <ChildFolder Name="Tables" />
    <ChildFolder Name="Views" />
    <ChildFolder Name="StoredProcedures" />
  </Node>

  <!-- Tables folder definition-->
  <Folder Name="Tables" Label="SR.SchemaHierarchy_Tables" ParentName = "Parent.Name">
    <ChildQuerier Type="Table" />
  </Folder>

  <!-- Table Query -->
  <Querier Name="Table" Node="Table" Query="
  SELECT
      S.name AS schemaName,
      T.name AS objectName,
      S.name AS parentName,
      CONCAT (S.name, '.', T.name) AS displayName,
      'Table' AS ObjectType
  FROM
      sys.schemas AS S
      JOIN sys.tables AS T ON S.schema_id = T.schema_id
  where
      t.temporal_type_desc = 'SYSTEM_VERSIONED_TEMPORAL_TABLE'
      or t.temporal_type_desc = 'NON_TEMPORAL_TABLE'
  " />

  <!-- Table Node -->
  <Node Name="Table" Type="Table" Icon="Table" isLeaf="false">
    <ChildFolder Name="TableColumns" />
  </Node>

  <!-- Columns folder definition-->
  <Folder Name="TableColumns" Label="SR.SchemaHierarchy_Columns" ParentName = "Parent.Name">
    <ChildQuerier Type="TableColumn" />
  </Folder>

  <!-- Table Columns Query -->
  <Querier 
    Name="TableColumn" 
    Node="Column" 
    Query="
    select 
    s.name as schemaName,
    c.name as objectName,
    t.name as parentName,
    c.name + 
    ' (' +
    tp.name +
    -- logic for length printing
    CASE  
        when tp.name IN ('char', 'nchar', 'binary', 'varchar', 'nvarchar', 'varbinary') THEN
        CASE 
            when c.max_length = -1 THEN '(max)'
            ELSE '(' +  CAST(c.max_length AS NVARCHAR) + ')'
        END 
        when tp.name IN ('datetime2', 'time', 'datetimeoffset') THEN '(' +  CAST(c.scale AS NVARCHAR) + ')'
        ELSE  ''
    END +
    -- logic for null/notnull
    CASE
        when c.is_nullable = 1 then ', null'
        ELSE ', not null'
    END +
     ')' 
     as displayName,
    'TableColumn' as type
FROM 
    sys.columns c
INNER JOIN 
    sys.tables t ON c.object_id = t.object_id
INNER JOIN
    sys.types tp ON c.user_type_id = tp.user_type_id
INNER JOIN
    sys.schemas s ON s.schema_id = t.schema_id
    "
  />

  <!-- Column Node -->
  <Node Name="TableColumn" Type="Column" Icon="Column" isLeaf="true" />


  <!-- Views folder definition-->
  <Folder Name="Views" Label="SR.SchemaHierarchy_Views" ParentName = "Parent.Name">
    <ChildQuerier Type="View" />
  </Folder>

  <!-- View Query -->
  <Querier Name="View" Node="View" Query="
  SELECT
      S.name AS schemaName,
      V.name AS objectName,
      S.name AS parentName,
      CONCAT (S.name, '.', V.name) AS displayName,
      'View' AS ObjectType
  FROM
      sys.schemas AS S
      JOIN sys.views AS V ON S.schema_id = V.schema_id
  " />

  <!-- View Node -->
  <Node Name="View" Type="View" Icon="View" isLeaf="false">
    <ChildFolder Name="ViewColumns" />
  </Node>

  <!-- Columns folder definition-->
  <Folder Name="ViewColumns" Label="SR.SchemaHierarchy_Columns" ParentName = "Parent.Name">
    <ChildQuerier Type="ViewColumn" />
  </Folder>
  
  <!-- Column Query -->
  <Querier 
    Name="ViewColumn" 
    Node="Column" 
    Query="
    select 
    s.name as schemaName,
    c.name as objectName,
    t.name as parentName,
    c.name + 
    ' (' +
    tp.name +
    -- logic for length printing
    CASE  
        when tp.name IN ('char', 'nchar', 'binary', 'varchar', 'nvarchar', 'varbinary') THEN
        CASE 
            when c.max_length = -1 THEN '(max)'
            ELSE '(' +  CAST(c.max_length AS NVARCHAR) + ')'
        END 
        when tp.name IN ('datetime2', 'time', 'datetimeoffset') THEN '(' +  CAST(c.scale AS NVARCHAR) + ')'
        ELSE  ''
    END +
    -- logic for null/notnull
    CASE
        when c.is_nullable = 1 then ', null'
        ELSE ', not null'
    END +
     ')' 
     as displayName,
    'ViewColumn' as type
FROM
    sys.columns c
INNER JOIN
    sys.views t ON c.object_id = t.object_id
INNER JOIN
    sys.types tp ON c.user_type_id = tp.user_type_id
INNER JOIN
    sys.schemas s ON s.schema_id = t.schema_id
"  />

  <!-- Column Node -->
  <Node Name="ViewColumn" Type="Column" Icon="Column" isLeaf="true" />

  <!-- Stored Procedures folder definition-->
  <Folder Name="StoredProcedures" Label="SR.SchemaHierarchy_StoredProcedures" ParentName = "Parent.Name">
    <ChildQuerier Type="StoredProcedure" />
  </Folder>

  <!-- Stored Procedure Query -->
  <Querier Name="StoredProcedure" Node="StoredProcedure" Query="
  SELECT
      S.name AS schemaName,
      P.name AS objectName,
      S.name AS parentName,
      CONCAT (S.name, '.', P.name) AS displayName,
      'StoredProcedure' AS ObjectType
  FROM
      sys.schemas AS S
      JOIN sys.procedures AS P ON S.schema_id = P.schema_id
  " />

  <!-- Stored Procedure Node -->
  <Node Name="StoredProcedure" Type="StoredProcedure" Icon="StoredProcedure" isLeaf="false" >
    <ChildFolder Name="StoredProcedureParameters" />
  </Node>

  <!-- Parameters folder definition-->
  <Folder Name="StoredProcedureParameters" Label="SR.SchemaHierarchy_Parameters" ParentName = "Parent.Name">
    <ChildQuerier Type="StoredProcedureParameter" />
  </Folder>

  <!-- Parameter Query -->
  <Querier 
    Name="StoredProcedureParameter" 
    Node="Parameter" 
    Query="
    select 
    s.name as schemaName,
    p.name as objectName,
    t.name as parentName,
    p.name + 
    ' (' +
    tp.name +
    -- logic for length printing
    CASE  
        when tp.name IN ('char', 'nchar', 'binary', 'varchar', 'nvarchar', 'varbinary') THEN
        CASE 
            when p.max_length = -1 THEN '(max)'
            ELSE '(' +  CAST(p.max_length AS NVARCHAR) + ')'
        END 
        when tp.name IN ('datetime2', 'time', 'datetimeoffset') THEN '(' +  CAST(p.scale AS NVARCHAR) + ')'
        ELSE  ''
    END +
    -- logic for null/notnull
    CASE
        when p.is_nullable = 1 then ', null'
        ELSE ', not null'
    END +
     ')' 
     as displayName,
    'StoredProcedureParameter' as type 
FROM
    sys.parameters p
INNER JOIN
    sys.procedures t ON p.object_id = t.object_id
INNER JOIN
    sys.types tp ON p.user_type_id = tp.user_type_id
INNER JOIN
    sys.schemas s ON s.schema_id = t.schema_id
"  />
  
    <!-- Parameter Node -->
    <Node Name="StoredProcedureParameter" Type="Parameter" Icon="Parameter" isLeaf="true" />



  

</ObjectExplorerModel>